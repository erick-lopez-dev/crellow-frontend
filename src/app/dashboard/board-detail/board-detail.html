<!-- Updated: board-detail/board-detail.component.html (added invite button) -->
@if(isLoading){
<div class="loading">Cargando board...</div>
}
@if(errorMessage){
<div class="error-message">{{ errorMessage }}</div>
}


<mat-card *ngIf="board && !isLoading" class="board-card">
  <mat-card-header class="header-container">
    <mat-card-title class="board-detail-title">{{ board.title }}</mat-card-title>
    <mat-card-subtitle>{{ board.description || 'Sin descripción' }}</mat-card-subtitle>
    <div class="board-detail-data">

      <p>Creado: {{ board.createdAt | date: 'medium' }}</p>
    </div>
    <button mat-icon-button (click)="openInviteDialog()" title="Invite User">
      <mat-icon>person_add</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>


    <div *ngIf="dropListIds.length > 0" cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="board.lists"
      class="lists-container" (cdkDropListDropped)="dropList($event)">
      @for (list of board.lists; track list._id) {
      <mat-card cdkDrag class="list-card">
        <mat-card-header cdkDragHandle>
          <mat-card-title>{{ list.title }}</mat-card-title>
          <button mat-icon-button [matMenuTriggerFor]="listMenu" class="menu-button">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #listMenu="matMenu">
            <button mat-menu-item (click)="editList(list)">Edit</button>
            <button mat-menu-item (click)="deleteList(list)">Delete</button>
          </mat-menu>
        </mat-card-header>
        <mat-card-content>
          <div cdkDropList [id]="'list-' + list._id" [cdkDropListData]="list.cards"
            [cdkDropListConnectedTo]="dropListIds" class="card-list" (cdkDropListDropped)="dropCard($event)">
            @for (card of list.cards; track card._id) {
            <mat-card cdkDrag class="card-card">
              <mat-card-header cdkDragHandle>
                <mat-card-title>{{ card.title }}</mat-card-title>
                <button mat-icon-button [matMenuTriggerFor]="cardMenu" class="menu-button">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #cardMenu="matMenu">
                  <button mat-menu-item (click)="editCard(list, card)">Edit</button>
                  <button mat-menu-item (click)="deleteCard(list, card)">Delete</button>
                </mat-menu>
              </mat-card-header>
              <mat-card-content>
                <p>{{ card.description || 'Sin descripción' }}</p>
                @if (card.members && card.members.length > 0) {
                <div class="members">
                  Miembros:
                  <mat-chip-listbox>
                    @for (member of card.members; track member.userId) {
                    <mat-chip>{{ member.userId }}</mat-chip>
                    }
                  </mat-chip-listbox>
                </div>
                }
                @if (card.labelIds && card.labelIds.length > 0) {
                <div class="labels">
                  Etiquetas:
                  <mat-chip-listbox>
                    @for (label of card.labelIds; track label) {
                    <mat-chip color="primary">{{ label }}</mat-chip>
                    }
                  </mat-chip-listbox>
                </div>
                }
                @if (card.dueDate) {
                <p>Fecha límite: {{ card.dueDate | date: 'shortDate' }}</p>
                }
              </mat-card-content>
            </mat-card>
            }
            @empty {
            <p>No hay tarjetas en esta lista.</p>
            }
          </div>
          <button class="custom-button" color="primary" (click)="createCard(list)">Add Card</button>
        </mat-card-content>
      </mat-card>
      }
      @empty {
      <p>No hay listas en este board.</p>
      }
    </div>
    <button class="custom-button" color="primary" (click)="createList()">Add List</button>
  </mat-card-content>
</mat-card>